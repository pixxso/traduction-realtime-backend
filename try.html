<script>
  document.getElementById('try-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const input = document.getElementById('input-text').value.trim();
    const from = document.getElementById('from').value;
    const to = document.getElementById('to').value;
    const specialty = document.getElementById('specialty').value;
    const output = document.getElementById('translation-output');

    if (!input) {
      output.innerHTML = "<p style='color:red;'>Veuillez entrer un texte à traduire.</p>";
      return;
    }

    output.innerHTML = "<p>⏳ Traduction en cours...</p>";

    try {
      const res = await fetch("https://rword-deepl-proxy.onrender.com/translate", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          text: input,
          source_lang: from,
          target_lang: to
        })
      });

      if (!res.ok) {
        const errorText = await res.text();
        throw new Error("Erreur proxy : " + errorText);
      }

      const data = await res.json();

      output.innerHTML = `
        <h3>Traduction (${from} → ${to}) – Spécialité : ${specialty}</h3>
        <p style="background:#e3f2fd;padding:1rem;border-radius:5px;">
          ${data.translations[0].text}
        </p>
        <p><a href="services.html" class="btn">Réservez une session ${specialty.toLowerCase()}</a></p>`;
    } catch (err) {
      console.error("Erreur attrapée :", err);
      output.innerHTML = "<p style='color:red;'>❌ La traduction a échoué. Essayez à nouveau dans quelques instants.</p>";
    }
  });
</script>
